<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ê°„ ì„±ê²½ ê³µê³¼ ëª¨ìŒ</title> <link rel="stylesheet" href="style.css">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4ZNLXJ9BR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z4ZNLXJ9BR');
</head>
<body>
    <button id="menuToggleButton" class="menu-toggle-button">â˜°</button>
    <div class="overlay"></div>

    <nav id="sidebarMenu" class="sidebar-menu">
        <h3>ëª©ë¡</h3>
        <ul id="archiveLinks">
            </ul>
    </nav>

    <div id="mainContentWrapper" class="main-content-wrapper">
        <div class="container">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="ìµœì‹  ì£¼ì°¨ ë‚´ìš©ì—ì„œ ê²€ìƒ‰..." id="searchInput">
            </div>

            <main id="latestWeekContentContainer" class="page-specific-content">
                <p style="text-align:center; padding: 50px 0; color: #777;">ìµœì‹  ì£¼ì°¨ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </main>
            <footer class="footer">
                <p>ğŸ“š ê³µê³¼ ê³µë¶€ì— ë„ì›€ì´ ë˜ê¸¸ ë°”ëë‹ˆë‹¤ ğŸ™</p>
            </footer>
        </div> 
    </div>

    <script src="menuData.js"></script> 
    <script>
        const menuToggleButton = document.getElementById('menuToggleButton');
        const sidebarMenu = document.getElementById('sidebarMenu');
        const overlay = document.querySelector('.overlay');
        const searchInput = document.getElementById('searchInput');
        const archiveLinksUl = document.getElementById('archiveLinks');
        const contentContainer = document.getElementById('latestWeekContentContainer');
        const pageTitleElement = document.querySelector('head title');

        // --- ë©”ë‰´ ìƒì„± í•¨ìˆ˜ ---
        function generateSidebarMenu() {
            if (typeof weeklyBibleStudies !== 'undefined' && weeklyBibleStudies.length > 0) {
                archiveLinksUl.innerHTML = ''; // ê¸°ì¡´ ë©”ë‰´ ì´ˆê¸°í™”
                const studiesToDisplay = [...weeklyBibleStudies]; // ì›ë³¸ ìœ ì§€ë¥¼ ìœ„í•´ ë³µì‚¬ (í•„ìš”ì‹œ ì •ë ¬)
                // ì˜ˆ: studiesToDisplay.sort((a,b) => new Date(b.date) - new Date(a.date)); // ìµœì‹ ìˆœ ì •ë ¬

                studiesToDisplay.forEach((study, index) => {
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = study.file; 
                    link.innerHTML = `<span class="title">${study.title}</span><span class="date">${study.date} - <i>${study.number}</i></span>`;
                    
                    const currentPath = window.location.pathname;
                    const currentFile = currentPath.substring(currentPath.lastIndexOf('/') + 1);

                    // index.htmlì´ê³ , í˜„ì¬ studyê°€ ë°°ì—´ì˜ ì²«ë²ˆì§¸ (ìµœì‹ ) í•­ëª©ì´ê±°ë‚˜,
                    // ë˜ëŠ” í˜„ì¬ íŒŒì¼ëª…ì´ study.fileê³¼ ì¼ì¹˜í•˜ë©´ active
                    if (((currentFile === '' || currentFile === 'index.html') && index === 0) || currentFile === study.file) {
                        link.classList.add('active-page-link');
                    }

                    listItem.appendChild(link);
                    archiveLinksUl.appendChild(listItem);
                });
            } else {
                archiveLinksUl.innerHTML = '<li>ë©”ë‰´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
            }
        }

        // --- êµ¬ì ˆ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¶€ì°© í•¨ìˆ˜ ---
        function attachVerseClickListeners(selector) {
            document.querySelectorAll(selector).forEach(verse => {
                if (verse.dataset.listenerAttached === 'true') return;
                verse.addEventListener('click', function() {
                    this.style.transform = 'scale(1.015)'; 
                    setTimeout(() => { this.style.transform = 'scale(1)'; }, 150); 
                });
                verse.dataset.listenerAttached = 'true';
            });
        }

        // --- ìµœì‹  ì£¼ì°¨ ë‚´ìš© ë™ì  ë¡œë“œ í•¨ìˆ˜ (index.html ì—ì„œë§Œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ê³„) ---
        function loadLatestWeekContent() {
            const currentPageFilename = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);
            // index.html ì´ê±°ë‚˜ ë£¨íŠ¸ ê²½ë¡œì¼ ë•Œë§Œ ì‹¤í–‰
            if (currentPageFilename === 'index.html' || currentPageFilename === '') {
                if (typeof weeklyBibleStudies !== 'undefined' && weeklyBibleStudies.length > 0) {
                    const latestStudy = weeklyBibleStudies[0]; // menuData.jsì—ì„œ ì²« ë²ˆì§¸ í•­ëª©ì´ ìµœì‹ 

                    if (latestStudy && latestStudy.file && contentContainer) {
                        fetch(latestStudy.file)
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP error! status: ${response.status} for ${latestStudy.file}`);
                                }
                                return response.text();
                            })
                            .then(htmlText => {
                                const parser = new DOMParser();
                                const doc = parser.parseFromString(htmlText, 'text/html');
                                const specificContent = doc.querySelector('.page-specific-content');
                                
                                if (specificContent) {
                                    contentContainer.innerHTML = specificContent.innerHTML;
                                    // í˜ì´ì§€ íƒ€ì´í‹€ë„ ìµœì‹  ì£¼ì°¨ ì œëª©ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                                    const loadedTitle = contentContainer.querySelector('.course-title');
                                    if (loadedTitle && pageTitleElement) {
                                        pageTitleElement.textContent = `${latestStudy.number}: ${loadedTitle.textContent.trim()} - ì„±ê²½ ê³µê³¼`;
                                    }
                                    // ë™ì ìœ¼ë¡œ ë¡œë“œëœ .verse ìš”ì†Œë“¤ì— í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë‹¤ì‹œ ë°”ì¸ë”©
                                    attachVerseClickListeners('#latestWeekContentContainer .verse');
                                } else {
                                    contentContainer.innerHTML = `<p style="text-align:center; color:red;">ìµœì‹  ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. '${latestStudy.file}' íŒŒì¼ì— '.page-specific-content' ì˜ì—­ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</p>`;
                                }
                            })
                            .catch(error => {
                                console.error('ìµœì‹  ë‚´ìš© ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                                contentContainer.innerHTML = `<p style="text-align:center; color:red;">ìµœì‹  ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê°œë°œì ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”. (${error})</p>`;
                            });
                    } else {
                         contentContainer.innerHTML = '<p style="text-align:center; color:red;">ìµœì‹  ì£¼ì°¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. menuData.jsë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
                    }
                } else {
                    contentContainer.innerHTML = '<p style="text-align:center; color:red;">ë©”ë‰´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. menuData.jsë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
                }
            } else {
                // index.htmlì´ ì•„ë‹Œ ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œëŠ” ì´ë¯¸ .page-specific-content ê°€ ìˆìœ¼ë¯€ë¡œ, í•´ë‹¹ ìš”ì†Œì˜ verseì—ë§Œ ë¦¬ìŠ¤ë„ˆ ë¶€ì°©
                 attachVerseClickListeners('.page-specific-content .verse');
            }
        }

        // --- ê²€ìƒ‰ ê¸°ëŠ¥ ---
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            let questionGroups;
            const currentPageFilenameForSearch = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);

            if (currentPageFilenameForSearch === 'index.html' || currentPageFilenameForSearch === '') {
                questionGroups = document.querySelectorAll('#latestWeekContentContainer .question-group');
            } else {
                questionGroups = document.querySelectorAll('.page-specific-content .question-group');
            }
            
            let matchFound = false;
            questionGroups.forEach(group => {
                const groupText = group.textContent.toLowerCase();
                if (groupText.includes(searchTerm)) {
                    group.style.display = 'block'; 
                    group.style.background = searchTerm ? 'linear-gradient(135deg, #fff5e1 0%, #ffeccf 100%)' : 'linear-gradient(135deg, #fdfbf7 0%, #f7f2ec 100%)';
                    matchFound = true;
                } else {
                    group.style.display = 'none'; 
                    group.style.background = 'linear-gradient(135deg, #fdfbf7 0%, #f7f2ec 100%)';
                }
            });
            // ê²€ìƒ‰ ê²°ê³¼ ì—†ì„ ë•Œ ë©”ì‹œì§€ (ì„ íƒ ì‚¬í•­)
            // if (!matchFound && searchTerm) { ... }
        });

        // --- ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰ ---
        generateSidebarMenu(); // ë©”ë‰´ ìƒì„±
        loadLatestWeekContent(); // index.htmlì¼ ê²½ìš° ìµœì‹  ë‚´ìš© ë¡œë“œ, ì•„ë‹ˆë©´ ê¸°ì¡´ verse ë¦¬ìŠ¤ë„ˆ ë¶€ì°©

        // ë©”ë‰´ í† ê¸€ ë° ì˜¤ë²„ë ˆì´
        menuToggleButton.addEventListener('click', function() {
            sidebarMenu.classList.toggle('open');
            overlay.classList.toggle('active');
        });
        overlay.addEventListener('click', function() { 
            sidebarMenu.classList.remove('open');
            overlay.classList.remove('active');
        });

    </script>
</body>
</html>
